---
- name: disable swap
  tags: always
  command: swapoff -a
  register: swapoff

- name: swapoff result
  debug:
    var: swapoff.stdout

# trun off swap permanently


# Verify the MAC address and product_uuid are unique for every node


# Check required ports  
- name: Install UFW
  dnf:
    name: ufw
    state: present

- name: Start UFW service
  systemd:
    name: ufw
    state: started
    enabled: yes

- name: open port 6443 on target machine
  become: yes
  ufw:
    rule: allow
    port: 6443
    proto: tcp

# Installing a container runtime


# Installing kubeadm, kubelet and kubectl
- name: add kubernetes repo to dnf
  copy:
    content: |
      sudo tee /etc/yum.repos.d/kubernetes.repo
      [kubernetes]
      name=Kubernetes
      baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\$basearch
      enabled=1
      gpgcheck=1
      gpgkey=https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
      exclude=kubelet kubeadm kubectl
    dest: /etc/yum.repos.d/kubernetes.repo
      #- name: Set SELinux in permissive mode (effectively disabling it) 
      #command: setenforce 0 && sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config
    #- name: update dnf cahce
    #command: dnf makecache

- name: install kubeadm, kubelet, kubectl on fedora
  dnf:
    name: kubeadm, kubelet, kubectl
  when: ansible_distribution=="Fedora"
    #- name: install kubernetes-kubeadm, kubectl, kubelet
    #  become: true
    #  package:
    #name: kubeadm, kubectl, kubelet
    #state: latest

# Configuring a cgroup driver

#

#

#

#

#
