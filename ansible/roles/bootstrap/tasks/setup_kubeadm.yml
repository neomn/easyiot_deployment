---
# trun off swap permanently
- name: run swapoff command
  become: yes
  command: swapoff -a
  changed_when: false

- name: Comment out swap entry in /etc/fstab
  lineinfile:
    path: /etc/fstab
    regexp: '.*swap.*'
    line: '#'
  register: swap_disabled
  changed_when: swap_disabled.changed






# Verify the MAC address and product_uuid are unique for every node





# open required ports  
- name: Install UFW
  dnf:
    name: ufw
    state: present

- name: Start UFW service
  systemd:
    name: ufw
    state: started
    enabled: yes

- name: open port 6443 on target machine
  become: yes
  ufw:
    rule: allow
    port: 6443
    proto: tcp



# Installing a container runtime interface (CRI)
- name: install cri-o prerequisits
  dnf:
    name: libseccomp glibc-langpack-en
    state: present
  when: ansible_distribution = "Fedora"

- name: adding cri-o repo to dnf
  dnf_repository:
    name: cri-o
    baseurl: https://cbs.centos.org/repos/paas7-crio-411-candidate/x86_64/os/
    description: cri-o repo
    gpgcheck: no
    state: present
  when: ansible_distribution = "Fedora"

- name: install cri-o
  dnf: 
    name: cri-o
    state: present

- name: start cri-o
  systemd:
    name: cri-o
    state: started
    enabled: yes



# Installing kubeadm, kubelet and kubectl





# Configuring a cgroup driver
